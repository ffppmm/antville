if (!this.isEditAllowed())
   res.redirect(user.cache.referer ? this.href("login") : this.__parent__.href());

res.skin = "main";

if (req.data.submit == "cancel")
   res.redirect(this.__parent__.href());
else if (req.data.submit == "save")
   this.updateUser();

res.head = this.__parent__.renderSkinAsString("style");
res.body = this.__parent__.renderSkinAsString("header");

res.body += user.renderSkinAsString("edit");