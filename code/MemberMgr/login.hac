var parent = setLayout();

res.message = "Please enter your login name and password:";

if (req.data.submit == "login" || req.data.login) {
   var result = this.evalLogin(req.data.name,req.data.password);
   res.message = result.message;
   if (!result.error) {
      if (user.cache.referrer) {
         var url = user.cache.referrer;
         user.cache.referrer = null;
      } else
         var url = parent.href();
      res.redirect(url);
   }
}

if (!user.cache.referrer && req.data.http_referer)
   user.cache.referrer = req.data.http_referer;

res.data.action = this.href(req.action);

res.data.title = path.weblog ? path.weblog.title : "Antville";

res.data.body = this.renderSkinAsString("login");

